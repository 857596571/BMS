<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.modules.system.mapper.SysLogMapper">

    <!-- 查询日志列表 -->
    <select id="findList" resultType="com.modules.system.entity.SysLog">
        select * from sys_log a
        WHERE a.del_flag != '1'
        <if test="@cn.hutool.core.util.StrUtil@isNotBlank(searchKeys)">
            AND a.description like CONCAT('%', #{searchKeys}, '%')
        </if>
        ORDER BY a.create_date desc
    </select>

    <!-- 保存日志 -->
    <insert id="insert" parameterType="com.modules.system.entity.SysLog">
		insert into sys_log
		(
			id, 
			description, 
			username, 
			start_time, 
			spend_time, 
			base_path, 
			uri, 
			url, 
			method, 
			parameter, 
			user_agent, 
			ip, 
			result, 
			permissions,
			create_date,
			create_user_id,
			update_user_id,
			update_date,
			del_flag
		) values (
			#{id}, 
			#{description}, 
			#{username}, 
			#{startTime}, 
			#{spendTime}, 
			#{basePath}, 
			#{uri}, 
			#{url}, 
			#{method}, 
			#{parameter}, 
			#{userAgent}, 
			#{ip}, 
			#{result}, 
			#{permissions},
			#{createDate},
			#{createUserId},
			#{updateUserId},
			#{updateDate},
			#{delFlag}
		)
	</insert>

    <!-- 更新日志 -->
    <update id="update" parameterType="com.modules.system.entity.SysLog">
        update sys_log
        <set>
            <if test="description != null">description = #{description},</if>
            <if test="username != null">username = #{username},</if>
            <if test="startTime != null">start_time = #{startTime},</if>
            <if test="spendTime != null">spend_time = #{spendTime},</if>
            <if test="basePath != null">base_path = #{basePath},</if>
            <if test="uri != null">uri = #{uri},</if>
            <if test="url != null">url = #{url},</if>
            <if test="method != null">method = #{method},</if>
            <if test="parameter != null">parameter = #{parameter},</if>
            <if test="userAgent != null">user_agent = #{userAgent},</if>
            <if test="ip != null">ip = #{ip},</if>
            <if test="result != null">result = #{result},</if>
            <if test="permissions != null">permissions = #{permissions}</if>
            <if test="createDate != null">create_date = #{createDate},</if>
            <if test="createUserId != null">create_user_id = #{createUserId},</if>
            <if test="updateUserId != null">update_user_id = #{updateUserId},</if>
            <if test="updateDate != null">update_date = #{updateDate},</if>
            <if test="delFlag != null">del_flag = #{delFlag},</if>
        </set>
        where id = #{id}
    </update>

    <!-- 删除日志 -->
    <update id="deleteById">
       delete from sys_log where id = #{value}
    </update>

</mapper>